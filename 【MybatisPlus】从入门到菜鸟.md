# MyBatisPlusä»å…¥é—¨åˆ°å®è·µ

## ğŸ”¸ç®€ä»‹

[MyBatis-Plus (opens new window)](https://github.com/baomidou/mybatis-plus)ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª [MyBatis (opens new window)](https://www.mybatis.org/mybatis-3/)çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚

**å®˜ç½‘**ï¼š[MyBatis-Plus (baomidou.com)](https://baomidou.com/)

## ğŸ”¸ç‰¹ç‚¹

- **æ— ä¾µå…¥**ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘
- **æŸè€—å°**ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ
- **å¼ºå¤§çš„ CRUD æ“ä½œ**ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚
- **æ”¯æŒ Lambda å½¢å¼è°ƒç”¨**ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™
- **æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ**ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜
- **æ”¯æŒ ActiveRecord æ¨¡å¼**ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ
- **æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ**ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰
- **å†…ç½®ä»£ç ç”Ÿæˆå™¨**ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨
- **å†…ç½®åˆ†é¡µæ’ä»¶**ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢
- **åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“**ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“
- **å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶**ï¼šå¯è¾“å‡º SQL è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢
- **å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶**ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ

## ğŸ”¸æ¡†æ¶ç»“æ„

![framework](PictureFile/ã€MybatisPlusã€‘ä»å…¥é—¨åˆ°èœé¸Ÿ.assets/mybatis-plus-framework.jpg)

## ğŸ”¸å…¥é—¨æ¡ˆä¾‹

- **SpringBootæ•´åˆMybatis-plus**

```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>

<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.2</version>
</dependency>

<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.2.11</version>
</dependency>
```

- **é…ç½®ymlæ•°æ®æºä¿¡æ¯**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/db1
    username: root
    password: 123456
    type: com.alibaba.druid.pool.DruidDataSource
```

- **Daoå±‚**

```java
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.Mapper;
import skyblog.domain.User;

@Mapper
public interface UserDao extends BaseMapper<User> { //è‡ªåŠ¨ç”Ÿæˆsqlæ— éœ€æ‰‹å†™
}
```

- **æµ‹è¯•**

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;

import java.util.List;

@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getAll() {
        User user = userDao.selectById(1);
        System.out.println(user);
    }
}
```

##   ğŸ”¸æŸ¥è¯¢

[æ¡ä»¶æ„é€ å™¨ | MyBatis-Plus (baomidou.com)](https://baomidou.com/pages/10c804/#abstractwrapper)

### ğŸ”¹åˆ†é¡µæŸ¥è¯¢

- **æ·»åŠ Pageæ‹¦æˆªå™¨**

```java
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MpConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor(){
        //å®šä¹‰Mpæ‹¦æˆªå™¨
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();
        //æ‹¦æˆªå™¨é‡Œé¢æ·»åŠ Pageæ‹¦æˆªå™¨
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor());
        return  mybatisPlusInterceptor;
    }
}
```

- **æµ‹è¯•**

```java
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;

@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        Page page = new Page(1,2);
        userDao.selectPage(page,null);
        System.out.println("å½“å‰é¡µç ï¼š"+page.getCurrent());
        System.out.println("æ¯é¡µæ˜¾ç¤ºçš„æ•°ç›®ï¼š"+page.getSize());
        System.out.println("ä¸€å…±æœ‰å¤šå°‘é¡µï¼š"+page.getPages());
        System.out.println("ä¸€ä¸ªæœ‰å¤šå°‘æ¡æ•°æ®ï¼š"+page.getTotal());
        System.out.println("æ•°æ®ï¼š"+page.getRecords());
    }
}
```

- **è¾“å‡º**

```xml
å½“å‰é¡µç ï¼š1
æ¯é¡µæ˜¾ç¤ºçš„æ•°ç›®ï¼š2
ä¸€å…±æœ‰å¤šå°‘é¡µï¼š11
ä¸€ä¸ªæœ‰å¤šå°‘æ¡æ•°æ®ï¼š22
æ•°æ®ï¼š[User{id=1, username='UpdateTest', password='123456'}, User{id=4, username='people2', password='123'}]
```

### ğŸ”¹ç­‰åŒ¹é…æŸ¥è¯¢

```java
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;
@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        //åŒ¹é…ç”¨æˆ·åå’Œå¯†ç 
        LambdaQueryWrapper<User> lqw = new LambdaQueryWrapper<>();
        lqw.eq(User::getUsername,"sky666").eq(User::getPassword,"123456");
        System.out.println(userDao.selectOne(lqw));
    }
}
```

### ğŸ”¹èŒƒå›´æŸ¥è¯¢

```java
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;
@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        //èŒƒå›´æŸ¥è¯¢
        LambdaQueryWrapper<User> lqw = new LambdaQueryWrapper<>();
        lqw.between(User::getId,2,10);
        System.out.println(userDao.selectList(lqw));
    }
}
```

### ğŸ”¹æ¨¡ç³ŠæŸ¥è¯¢

```java
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;
@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        //æ¨¡ç³ŠæŸ¥è¯¢
        LambdaQueryWrapper<User> lqw = new LambdaQueryWrapper<>();
        lqw.like(User::getUsername,"sky");
        System.out.println(userDao.selectList(lqw));
    }
}
```

## ğŸ”¸åˆ é™¤

### ğŸ”¹æ™®é€šåˆ é™¤

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import java.util.ArrayList;

@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        ArrayList<Long> longs = new ArrayList<>();
        longs.add(1550033459488088066L);
        longs.add(1550034549189177346L);
        userDao.deleteBatchIds(longs);//å¤šé¡¹åˆ é™¤
    }
}
```

### ğŸ”¹é€»è¾‘åˆ é™¤

- **æ·»åŠ é€»è¾‘åˆ é™¤å­—æ®µ**

> é€šè¿‡å†™ymlé…ç½®æ–‡ä»¶äº¦å¯

```java
@TableName("users")
public class User {
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;
    private String username;
    private String password;
    @TableLogic(value = "0",delval = "1")//è®¾ç½®é€»è¾‘åˆ é™¤å­—æ®µ
    private Integer deleted;
}
```

- **æµ‹è¯•**

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;

@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        userDao.deleteById(1);
    }
}
```

- **ç»“æœ**

```xml
==>  Preparing: UPDATE users SET deleted=1 WHERE id=? AND deleted=0
==> Parameters: 1(Integer)
<==    Updates: 1
```

## ğŸ”¸æ˜ å°„

<img src="PictureFile/ã€MybatisPlusã€‘ä»å…¥é—¨åˆ°èœé¸Ÿ.assets/image-20220721151704599.png" alt="image-20220721151704599" style="zoom:80%;" />

### ğŸ”¹å­—æ®µæ˜ å°„

```java
@TableName("users")//è¡¨åæ˜ å°„
public class User {
    private Integer id;
    private String username;
    @TableField(value = "password",select = false)//å­—æ®µæ˜ å°„ï¼Œä¸å‚ä¸æŸ¥è¯¢
    private String password;
    @TableField(exist = false)//è®¾ç½®ä¸ºä¸å­˜åœ¨
    private String Online;
    }
```

### ğŸ”¹è¡¨åæ˜ å°„

> **@TableName("users")//è¡¨åæ˜ å°„**

## ğŸ”¸IDç”Ÿæˆç­–ç•¥

- #### domainä¸­åšé…ç½®

```java
@TableName("users")
public class User {
    @TableId(type = IdType.ASSIGN_ID)//é›ªèŠ±ç®—æ³•
    private Long id;
    private String username;
    private String password;
    }
```

- #### æµ‹è¯•

```java
mport org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;
@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        User user = new User(null,"sky","555555");
        userDao.insert(user);
    }
}
```

- #### ç»“æœ

```xml
==> Preparing: INSERT INTO users ( id, username, password ) VALUES ( ?, ?, ? )
==> Parameters: 1550034549189177346(Long), sky(String), 555555(String)
```

## ğŸ”¸é”

### ğŸ”¹ä¹è§‚é”

- **æ·»åŠ ä¹è§‚é”å­—æ®µ**

```java
@TableName("users")
public class User {
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;
    private String username;
    private String password;
    @TableLogic(value = "0",delval = "1")
    private Integer deleted;
    @Version//ä¹è§‚é”å­—æ®µ
    private Integer version;
}
```

- **æ·»åŠ æ‹¦æˆªå™¨**

```java
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.OptimisticLockerInnerInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MpConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor(){
        //å®šä¹‰Mpæ‹¦æˆªå™¨
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();
        //æ‹¦æˆªå™¨é‡Œé¢æ·»åŠ Pageæ‹¦æˆªå™¨
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor());
        //æ·»åŠ ä¹è§‚é”æ‹¦æˆªå™¨
        mybatisPlusInterceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        return  mybatisPlusInterceptor;
    }
}
```

- **æµ‹è¯•**

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import skyblog.dao.UserDao;
import skyblog.domain.User;

@SpringBootTest
class ApplicationTests {
    @Autowired
    private UserDao userDao;

    @Test
    void getByPage(){
        //æ¨¡æ‹Ÿä¸¤ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®
        User user1 = userDao.selectById(4);
        User user2 = userDao.selectById(4);

        user1.setUsername("user1");
        userDao.updateById(user1);

        user2.setUsername("user2");
        userDao.updateById(user2);
    }
}
```

- **ç»“æœ**

```xml
==>  Preparing: SELECT id,username,password,deleted,version FROM users WHERE id=? AND deleted=0
==> Parameters: 4(Integer)
<==    Columns: id, username, password, deleted, version
<==        Row: 4, people2, 123, 0, 1
<==      Total: 1

==>  Preparing: SELECT id,username,password,deleted,version FROM users WHERE id=? AND deleted=0
==> Parameters: 4(Integer)
<==    Columns: id, username, password, deleted, version
<==        Row: 4, people2, 123, 0, 1
<==      Total: 1

==>  Preparing: UPDATE users SET username=?, password=?, version=? WHERE id=? AND version=? AND deleted=0
==> Parameters: user1(String), 123(String), 2(Integer), 4(Long), 1(Integer)
<==    Updates: 1

==>  Preparing: UPDATE users SET username=?, password=?, version=? WHERE id=? AND version=? AND deleted=0
==> Parameters: user2(String), 123(String), 2(Integer), 4(Long), 1(Integer)
<==    Updates: 0
```

- **åŸç†è§£é‡Š**

> å½“ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªç”¨æˆ·èƒ½å¤Ÿä¿®æ”¹æˆåŠŸï¼Œå› ä¸ºå½“ç¬¬äºŒä¸ªç”¨æˆ·è®¿é—®æ—¶ã€‚versionçš„å€¼å·²ç»å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ä¿®æ”¹æ“ä½œæ— æ³•æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ï¼Œå¯¼è‡´ä¿®æ”¹å¤±è´¥ã€‚

## ğŸ”¸ä»£ç ç”Ÿæˆå™¨

https://www.bilibili.com/video/BV12T4y1B7C3?p=14&t=846.1
